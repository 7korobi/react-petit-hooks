{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///external \"lodash\"","webpack:///external \"dexie\"","webpack:///./lib/device.ts","webpack:///./lib/browser.ts","webpack:///./lib/time.ts","webpack:///./lib/poll.ts","webpack:///./lib/storage.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","__SPEC__","window","__BROWSER__","vp","location","hostname","visualViewport","width","height","scale","ViewBox","size","useInternet","isOnline","setIsOnline","addEventListener","network_state","removeEventListener","navigator","onLine","useVisible","isVisible","setIsVisible","document","visible_state","visibilityState","useKeyboard","keyboard","e","console","log","useContextMenu","isMenu","setIsMenu","style","body","setProperty","deny","preventDefault","useViewport","setWidth","setHeight","setScale","resize","AccelAxis","min","max","minus","plus","this","oldVal","RotateAxis","CompassAxis","Math","floor","GeoAxis","MksAxis","xAxis","yAxis","zAxis","arAxis","brAxis","grAxis","altAxis","spdAxis","aAxis","bAxis","gAxis","latAxis","lonAxis","headAxis","useDeviceOrientation","rotate","alpha","setAlpha","chkRotate","beta","setBeta","gamma","setGamma","absolute","setAbsolute","DeviceOrientationEvent","requestPermission","then","ps","onOrientation","newVal","axis","useDeviceMotion","motion","ax","setAx","chkMotion","ay","setAy","az","setAz","gx","setGx","gy","setGy","gz","setGz","mx","setMx","my","setMy","mz","setMz","interval","setInterval","DeviceMotionEvent","onMotion","acceleration","accelerationIncludingGravity","rotationRate","x","y","z","useGeoLocation","geo","mks","latitude","setLatitude","chkGeo","longitude","setLongitude","heading","setHeading","altitude","setAltitude","chkMks","speed","setSpeed","geolocation","watch_id","watchPosition","onPosition","code","enableHighAccuracy","maximumAge","timeout","clearWatch","coords","timestamp","SECOND","to_msec","MINUTE","HOUR","DAY","WEEK","MONTH","YEAR","VALID","timezone","Date","getTimezoneOffset","tempo_zero","getDay","TIMERS","DISTANCE_NAN","DISTANCE_LONG_AGO","Infinity","DISTANCES","Tempo","zero","now_idx","write_at","last_at","next_at","table","since","at","that","slide","sub1","sub2","subf","to_tempo_bare","do2","center_at","do3","do1","step","a","reset","b","upto","limit","ary","push","succ","idx","modulo","length","table_idx_diff","table_diff","now","to_tempo_by","sleep","Error","tempos","reduce","Promise","ok","setTimeout","to_tempo","size_str","zero_str","Number","scan_at","table_size","table_idx","top_idx","mid_idx","str","to_sec","replace","_full","num_str","_fullunit","unit","appendix","num","to_timer","msec","unit_mode","_limit","base","to_relative_time_distance","NaN","roops","timers","is_cache","dexie","is_online","is_visible","values","forEach","roop","clearTimeout","usePoll","api","initState","timestr","version","args","join","tempo","list","setList","async","_a","_b","_c","meta","data","wait","getTime","get_pass","get_by_lf","get_by_api","put","error","pack","stores","Bits","bits","undefined","includes","parseInt","_","copy","toString","labels","BitsProcess","target","BitsBox","cb","get_labels","count","res","reverse","super","label","all","bit","mask","Boolean","set","to_Boolean","to_String","u","nil","String","to_Number","to_Array","Array","to_str","constructor","JSON","stringify","by_str","parse","to_url","encodeURIComponent","map","by_url","decodeURIComponent","defaults","dataStore","share","debug","doSharesDown","path","tail","val","keys","extPath","doShare","doSharesUp","subPath","slice","pushState","defineUrlStore","pushStateStorage","replaceState","replaceStateStorage","store","defineStore","localStore","LocalStorage","sessionStore","SessionStorage","storage","to","by","rootPath","item","getItem","rootCb","setItem","removeItem","Set","add","UrlStorage","rootPaths","PATH","HASH","BASIC_AUTH","defs","href","history","BaseUrl","hash","search","pathname","username","password","protocol","host","URL","split","query","vals","useStore","path_obj","delete","localStorage","sessionStorage","warn","newValue"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","module.exports = require(\"react\");","module.exports = require(\"lodash\");","module.exports = require(\"dexie\");","export const __SPEC__ = \"undefined\" === typeof window;\r\nexport const __BROWSER__ = !__SPEC__;\r\nexport const __TEST__ = __SPEC__ || \"localhost\" === location.hostname;\r\n","import { useEffect, useState, useReducer } from \"react\";\r\nimport { __BROWSER__ } from \"./device\";\r\nconst vp = __BROWSER__\r\n    ? window.visualViewport\r\n    : { width: 0, height: 0, scale: 1 };\r\nexport const ViewBox = {\r\n    size: [vp.width, vp.height],\r\n    scale: vp.scale,\r\n};\r\nexport function useInternet() {\r\n    const [isOnline, setIsOnline] = useState(true);\r\n    if (__BROWSER__) {\r\n        useEffect(() => {\r\n            window.addEventListener(\"offline\", network_state);\r\n            window.addEventListener(\"online\", network_state);\r\n            return () => {\r\n                window.removeEventListener(\"offline\", network_state);\r\n                window.removeEventListener(\"online\", network_state);\r\n            };\r\n        }, []);\r\n    }\r\n    return [isOnline];\r\n    function network_state() {\r\n        setIsOnline(window.navigator.onLine);\r\n    }\r\n}\r\nexport function useVisible() {\r\n    const [isVisible, setIsVisible] = useState(true);\r\n    if (__BROWSER__) {\r\n        useEffect(() => {\r\n            document.addEventListener(\"visibilitychange\", visible_state);\r\n            return () => {\r\n                document.removeEventListener(\"visibilitychange\", visible_state);\r\n            };\r\n        }, []);\r\n    }\r\n    return [isVisible];\r\n    function visible_state() {\r\n        setIsVisible(\"hidden\" !== document.visibilityState);\r\n    }\r\n}\r\nexport function useKeyboard() {\r\n    if (__BROWSER__) {\r\n        useEffect(() => {\r\n            document.addEventListener(\"keyup\", keyboard);\r\n            return () => {\r\n                document.removeEventListener(\"keyup\", keyboard);\r\n            };\r\n        }, []);\r\n    }\r\n    return [];\r\n    function keyboard(e) {\r\n        console.log(e);\r\n    }\r\n}\r\nexport function useContextMenu() {\r\n    const [isMenu, setIsMenu] = useState(true);\r\n    if (__BROWSER__) {\r\n        useEffect(() => {\r\n            const { style } = document.body;\r\n            if (isMenu) {\r\n                style.setProperty(\"--menu-display\", \"block\");\r\n            }\r\n            else {\r\n                style.setProperty(\"--menu-display\", \"none\");\r\n            }\r\n        }, [isMenu]);\r\n        useEffect(() => {\r\n            document.addEventListener(\"contextmenu\", deny);\r\n            return () => {\r\n                document.removeEventListener(\"contextmenu\", deny);\r\n            };\r\n        }, []);\r\n    }\r\n    return [isMenu, setIsMenu];\r\n    function deny(e) {\r\n        e.preventDefault();\r\n        setIsMenu(true);\r\n    }\r\n}\r\nexport function useViewport() {\r\n    const [width, setWidth] = useState(ViewBox.size[0]);\r\n    const [height, setHeight] = useState(ViewBox.size[1]);\r\n    const [scale, setScale] = useState(ViewBox.scale);\r\n    if (__BROWSER__) {\r\n        useEffect(() => {\r\n            resize();\r\n            window.visualViewport.addEventListener(\"resize\", resize);\r\n            window.addEventListener(\"orientationChange\", resize);\r\n            return () => {\r\n                window.visualViewport.removeEventListener(\"resize\", resize);\r\n                window.addEventListener(\"orientationChange\", resize);\r\n            };\r\n        }, []);\r\n    }\r\n    return [width, height, scale];\r\n    function resize() {\r\n        const { style } = document.body;\r\n        const { scale, width, height } = window.visualViewport;\r\n        ViewBox.scale = scale;\r\n        setScale(scale);\r\n        if (scale === 1) {\r\n            style.setProperty(\"--view-width\", `${width}px`);\r\n            style.setProperty(\"--view-height\", `${height}px`);\r\n            ViewBox.size = [width, height];\r\n            setWidth(width);\r\n            setHeight(height);\r\n        }\r\n    }\r\n}\r\nclass AccelAxis {\r\n    constructor(min, max, minus, plus) {\r\n        this.min = min;\r\n        this.max = max;\r\n        this.minus = minus;\r\n        this.plus = plus;\r\n    }\r\n    label(n, oldVal) {\r\n        if (null === n) {\r\n            return null;\r\n        }\r\n        if (n < -4) {\r\n            return this.minus;\r\n        }\r\n        if (4 < n) {\r\n            return this.plus;\r\n        }\r\n        if (oldVal === this.minus && n < -1) {\r\n            return this.minus;\r\n        }\r\n        if (oldVal === this.plus && 1 < n) {\r\n            return this.plus;\r\n        }\r\n        return \"\";\r\n    }\r\n}\r\nclass RotateAxis {\r\n    constructor(min, max, minus, plus) {\r\n        this.min = min;\r\n        this.max = max;\r\n        this.minus = minus;\r\n        this.plus = plus;\r\n    }\r\n    label(n, oldVal) {\r\n        if (null === n) {\r\n            return null;\r\n        }\r\n        if (n < -140) {\r\n            return this.minus;\r\n        }\r\n        if (140 < n) {\r\n            return this.plus;\r\n        }\r\n        if (oldVal === this.minus && n < -30) {\r\n            return this.minus;\r\n        }\r\n        if (oldVal === this.plus && 30 < n) {\r\n            return this.plus;\r\n        }\r\n        return \"\";\r\n    }\r\n}\r\nclass CompassAxis {\r\n    constructor(min, max) {\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    label(n) {\r\n        if (null === n) {\r\n            return null;\r\n        }\r\n        const n1 = Math.floor(n);\r\n        const n2 = Math.floor((n * 60) % 60);\r\n        const n3 = Math.floor((n * 3600) % 60);\r\n        return `${n1}°${n2}′${n3}″`;\r\n    }\r\n}\r\nclass GeoAxis {\r\n    constructor(min, max, minus, plus) {\r\n        this.min = min;\r\n        this.max = max;\r\n        this.minus = minus;\r\n        this.plus = plus;\r\n    }\r\n    label(n) {\r\n        if (null === n) {\r\n            return null;\r\n        }\r\n        const n1 = Math.floor(n);\r\n        const n2 = Math.floor((n * 60) % 60);\r\n        const n3 = Math.floor((n * 3600) % 60);\r\n        const n4 = Math.floor((n * 216000) % 60);\r\n        const n5 = Math.floor((n * 12960000) % 60);\r\n        const mark = n < 0 ? this.minus : this.plus;\r\n        return `${n1}°${n2}′${n3}″${n4}‴${n5}⁗${mark}`;\r\n    }\r\n}\r\nclass MksAxis {\r\n    constructor(min, max) {\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    label(n) {\r\n        if (null === n) {\r\n            return null;\r\n        }\r\n        const n1 = Math.floor(n);\r\n        const n2 = Math.floor((n * 100) % 100);\r\n        return `${n1}ｍ${n2}㎝`;\r\n    }\r\n}\r\n// 運動座標系\r\nconst xAxis = new AccelAxis(-10, 10, \"右\", \"左\"); // m/s2\r\nconst yAxis = new AccelAxis(-10, 10, \"上\", \"下\"); // m/s2\r\nconst zAxis = new AccelAxis(-10, 10, \"表\", \"裏\"); // m/s2\r\nconst arAxis = new RotateAxis(-360, 360, \"俯下\", \"仰上\"); // degree/s\r\nconst brAxis = new RotateAxis(-360, 360, \"左折\", \"右折\"); // degree/s\r\nconst grAxis = new RotateAxis(-360, 360, \"左巻\", \"右巻\"); // degree/s\r\nconst altAxis = new MksAxis(0, 10); // m\r\nconst spdAxis = new MksAxis(0, 10); // m/s\r\n// 地球座標系\r\nconst aAxis = new CompassAxis(0, 360); // degree\r\nconst bAxis = new GeoAxis(-180, 180, \"左折\", \"右折\"); // degree\r\nconst gAxis = new GeoAxis(-90, 90, \"左巻\", \"右巻\"); // degree\r\nconst latAxis = new GeoAxis(-180, 180, \"E\", \"W\");\r\nconst lonAxis = new GeoAxis(-90, 90, \"N\", \"S\");\r\nconst headAxis = new CompassAxis(0, 360); // degree\r\nexport function useDeviceOrientation(rotate) {\r\n    const [alpha, setAlpha] = useReducer(chkRotate, rotate(null, null, aAxis));\r\n    const [beta, setBeta] = useReducer(chkRotate, rotate(null, null, bAxis));\r\n    const [gamma, setGamma] = useReducer(chkRotate, rotate(null, null, gAxis));\r\n    const [absolute, setAbsolute] = useState(true);\r\n    if (__BROWSER__) {\r\n        useEffect(() => {\r\n            if (DeviceOrientationEvent.requestPermission) {\r\n                DeviceOrientationEvent.requestPermission().then((ps) => {\r\n                    if (\"granted\" === ps) {\r\n                        window.addEventListener(\"deviceorientation\", onOrientation);\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                window.addEventListener(\"deviceorientation\", onOrientation);\r\n            }\r\n            return () => {\r\n                window.addEventListener(\"deviceorientation\", onOrientation);\r\n            };\r\n        }, []);\r\n    }\r\n    return [[alpha, beta, gamma], absolute];\r\n    function onOrientation({ alpha, beta, gamma, absolute, }) {\r\n        setAlpha([alpha, aAxis]);\r\n        setBeta([beta, bAxis]);\r\n        setGamma([gamma, gAxis]);\r\n        setAbsolute(absolute);\r\n    }\r\n    function chkRotate(oldVal, [newVal, axis]) {\r\n        return rotate(oldVal, newVal, axis);\r\n    }\r\n}\r\nexport function useDeviceMotion(motion, rotate) {\r\n    const [ax, setAx] = useReducer(chkMotion, motion(null, null, xAxis));\r\n    const [ay, setAy] = useReducer(chkMotion, motion(null, null, yAxis));\r\n    const [az, setAz] = useReducer(chkMotion, motion(null, null, zAxis));\r\n    const [gx, setGx] = useReducer(chkMotion, motion(null, null, xAxis));\r\n    const [gy, setGy] = useReducer(chkMotion, motion(null, null, yAxis));\r\n    const [gz, setGz] = useReducer(chkMotion, motion(null, null, zAxis));\r\n    const [mx, setMx] = useReducer(chkMotion, motion(null, null, xAxis));\r\n    const [my, setMy] = useReducer(chkMotion, motion(null, null, yAxis));\r\n    const [mz, setMz] = useReducer(chkMotion, motion(null, null, zAxis));\r\n    const [alpha, setAlpha] = useReducer(chkRotate, rotate(null, null, arAxis));\r\n    const [beta, setBeta] = useReducer(chkRotate, rotate(null, null, brAxis));\r\n    const [gamma, setGamma] = useReducer(chkRotate, rotate(null, null, grAxis));\r\n    const [interval, setInterval] = useState(0);\r\n    if (__BROWSER__) {\r\n        useEffect(() => {\r\n            if (DeviceMotionEvent.requestPermission) {\r\n                DeviceMotionEvent.requestPermission().then((ps) => {\r\n                    if (\"granted\" === ps) {\r\n                        window.addEventListener(\"devicemotion\", onMotion);\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                window.addEventListener(\"devicemotion\", onMotion);\r\n            }\r\n            return () => {\r\n                window.addEventListener(\"devicemotion\", onMotion);\r\n            };\r\n        }, []);\r\n    }\r\n    return [\r\n        [ax, ay, az],\r\n        [gx, gy, gz],\r\n        [mx, my, mz],\r\n        [alpha, beta, gamma],\r\n        interval,\r\n    ];\r\n    function onMotion({ interval, acceleration, accelerationIncludingGravity, rotationRate, }) {\r\n        const { x: ax, y: ay, z: az } = acceleration;\r\n        const { x: mx, y: my, z: mz } = accelerationIncludingGravity;\r\n        const { alpha, beta, gamma } = rotationRate;\r\n        setAx([ax, xAxis]);\r\n        setAy([ay, yAxis]);\r\n        setAz([az, zAxis]);\r\n        setMx([mx, xAxis]);\r\n        setMy([my, yAxis]);\r\n        setMz([mz, zAxis]);\r\n        setGx([mx - ax, xAxis]);\r\n        setGy([my - ay, yAxis]);\r\n        setGz([mz - az, zAxis]);\r\n        setAlpha([alpha, arAxis]);\r\n        setBeta([beta, brAxis]);\r\n        setGamma([gamma, grAxis]);\r\n        setInterval(interval);\r\n    }\r\n    function chkMotion(oldVal, [newVal, axis]) {\r\n        return motion(oldVal, newVal, axis);\r\n    }\r\n    function chkRotate(oldVal, [newVal, axis]) {\r\n        return rotate(oldVal, newVal, axis);\r\n    }\r\n}\r\nexport function useGeoLocation(geo, mks) {\r\n    const [latitude, setLatitude] = useReducer(chkGeo, geo(null, null, latAxis));\r\n    const [longitude, setLongitude] = useReducer(chkGeo, geo(null, null, lonAxis));\r\n    const [heading, setHeading] = useReducer(chkCompass, geo(null, null, headAxis));\r\n    const [altitude, setAltitude] = useReducer(chkMks, mks(null, null, altAxis));\r\n    const [speed, setSpeed] = useReducer(chkMks, mks(null, null, spdAxis));\r\n    if (__BROWSER__) {\r\n        if (!(navigator === null || navigator === void 0 ? void 0 : navigator.geolocation)) {\r\n            return [[latitude, longitude], altitude, heading, speed];\r\n        }\r\n        useEffect(() => {\r\n            const watch_id = navigator.geolocation.watchPosition(onPosition, ({ code }) => {\r\n                console.log(`error watchPosition = ${code}`);\r\n            }, {\r\n                enableHighAccuracy: true,\r\n                maximumAge: 60 * 1000,\r\n                timeout: 10 * 1000,\r\n            });\r\n            return () => {\r\n                navigator.geolocation.clearWatch(watch_id);\r\n            };\r\n        }, []);\r\n    }\r\n    return [[latitude, longitude], altitude, heading, speed];\r\n    function onPosition({ coords, timestamp }) {\r\n        let { latitude, longitude, altitude, heading, speed } = coords;\r\n        setLongitude([longitude, lonAxis]);\r\n        setLatitude([latitude, latAxis]);\r\n        if (altitude !== null)\r\n            setAltitude([altitude, altAxis]);\r\n        if (heading !== null)\r\n            setHeading([heading, headAxis]);\r\n        if (speed !== null)\r\n            setSpeed([speed, spdAxis]);\r\n    }\r\n    function chkCompass(oldVal, [newVal, axis]) {\r\n        return geo(oldVal, newVal, axis);\r\n    }\r\n    function chkGeo(oldVal, [newVal, axis]) {\r\n        return geo(oldVal, newVal, axis);\r\n    }\r\n    function chkMks(oldVal, [newVal, axis]) {\r\n        return mks(oldVal, newVal, axis);\r\n    }\r\n}\r\n","const SECOND = to_msec(\"1s\");\r\nconst MINUTE = to_msec(\"1m\");\r\nconst HOUR = to_msec(\"1h\");\r\nconst DAY = to_msec(\"1d\");\r\nconst WEEK = to_msec(\"1w\");\r\nconst MONTH = to_msec(\"30d\");\r\nconst YEAR = to_msec(\"1y\");\r\nconst INTERVAL = 0x7fffffff; // 31bits.\r\nconst VALID = 0xfffffffffffff; // 52bits.\r\nconst timezone = typeof window !== \"undefined\" ? (MINUTE * new Date().getTimezoneOffset()) : to_msec(\"-9h\");\r\nconst tempo_zero = (-new Date(0).getDay()) * DAY + timezone;\r\nconst TIMERS = [\r\n    [\"年\", \"y\", YEAR],\r\n    [\"週\", \"w\", WEEK],\r\n    [\"日\", \"d\", DAY],\r\n    [\"時\", \"h\", HOUR],\r\n    [\"分\", \"m\", MINUTE],\r\n    [\"秒\", \"s\", SECOND],\r\n];\r\nconst DISTANCE_NAN = [-VALID, INTERVAL, YEAR, \"？？？\"];\r\nconst DISTANCE_LONG_AGO = [Infinity, INTERVAL, VALID, \"昔\"];\r\nconst DISTANCES = [\r\n    DISTANCE_NAN,\r\n    [-YEAR, INTERVAL, YEAR, \"%s年後\"],\r\n    [-MONTH, INTERVAL, MONTH, \"%sヶ月後\"],\r\n    [-WEEK, WEEK, WEEK, \"%s週間後\"],\r\n    [-DAY, DAY, DAY, \"%s日後\"],\r\n    [-HOUR, HOUR, HOUR, \"%s時間後\"],\r\n    [-MINUTE, MINUTE, MINUTE, \"%s分後\"],\r\n    [-25000, SECOND, SECOND, \"%s秒後\"],\r\n    [25000, 25000, 25000, \"今\"],\r\n    [MINUTE, SECOND, SECOND, \"%s秒前\"],\r\n    [HOUR, MINUTE, MINUTE, \"%s分前\"],\r\n    [DAY, HOUR, HOUR, \"%s時間前\"],\r\n    [WEEK, DAY, DAY, \"%s日前\"],\r\n    [MONTH, WEEK, WEEK, \"%s週間前\"],\r\n    [YEAR, INTERVAL, MONTH, \"%sヶ月前\"],\r\n    [VALID, INTERVAL, YEAR, \"%s年前\"],\r\n    DISTANCE_LONG_AGO,\r\n];\r\nexport class Tempo {\r\n    constructor(zero, now_idx, write_at, last_at, next_at, table = null) {\r\n        if (table) {\r\n            this.table = table;\r\n        }\r\n        this.zero = zero;\r\n        this.write_at = write_at;\r\n        this.now_idx = now_idx;\r\n        this.last_at = last_at;\r\n        this.next_at = next_at;\r\n    }\r\n    get size() { return this.next_at - this.last_at; }\r\n    get since() { return this.write_at - this.last_at; }\r\n    get remain() { return this.next_at - this.write_at; }\r\n    get timeout() { return this.next_at - this.write_at; }\r\n    get center_at() { return (this.next_at + this.last_at) / 2; }\r\n    get moderate_at() {\r\n        if (this.now_idx & 1) {\r\n            return this.last_at;\r\n        }\r\n        else {\r\n            return this.next_at;\r\n        }\r\n    }\r\n    get deg() {\r\n        return `${Math.floor(360 * this.since / this.size)}deg`;\r\n    }\r\n    is_cover(at) { return this.last_at <= at && at < this.next_at; }\r\n    is_hit(that) { return (this.last_at <= that.next_at && that.last_at < this.next_at); }\r\n    succ(n = 1) { return this.slide(+n); }\r\n    back(n = 1) { return this.slide(-n); }\r\n    slide_to(n) { return this.slide(n - this.now_idx); }\r\n    round(sub1, sub2, subf = to_tempo_bare) {\r\n        let { last_at, write_at, next_at, now_idx, size } = this;\r\n        (() => {\r\n            const do2 = subf(sub1, sub2, last_at);\r\n            if (write_at < do2.center_at) {\r\n                ({ last_at, size } = this.slide(-1));\r\n                const do3 = subf(sub1, sub2, last_at);\r\n                next_at = do2.center_at;\r\n                last_at = do3.center_at;\r\n                now_idx--;\r\n                return;\r\n            }\r\n            const do1 = subf(sub1, sub2, next_at);\r\n            if (do1.center_at <= write_at) {\r\n                ({ next_at, size } = this.slide(1));\r\n                const do3 = subf(sub1, sub2, next_at);\r\n                last_at = do1.center_at;\r\n                next_at = do3.center_at;\r\n                now_idx++;\r\n                return;\r\n            }\r\n            next_at = do1.center_at;\r\n            last_at = do2.center_at;\r\n        })();\r\n        const zero = last_at - now_idx * size;\r\n        return new Tempo(zero, now_idx, write_at, last_at, next_at);\r\n    }\r\n    ceil(sub1, sub2, subf = to_tempo_bare) {\r\n        let { last_at, write_at, next_at, now_idx, size } = this;\r\n        const do2 = subf(sub1, sub2, last_at);\r\n        if (write_at < do2.next_at) {\r\n            ({ last_at, size } = this.slide(-1));\r\n            const do3 = subf(sub1, sub2, last_at);\r\n            next_at = do2.next_at;\r\n            last_at = do3.next_at;\r\n            now_idx--;\r\n        }\r\n        else {\r\n            const do1 = subf(sub1, sub2, next_at);\r\n            next_at = do1.next_at;\r\n            last_at = do2.next_at;\r\n        }\r\n        const zero = last_at - now_idx * size;\r\n        return new Tempo(zero, now_idx, write_at, last_at, next_at);\r\n    }\r\n    floor(sub1, sub2, subf = to_tempo_bare) {\r\n        let { last_at, write_at, next_at, now_idx, size } = this;\r\n        const do2 = subf(sub1, sub2, next_at);\r\n        if (do2.last_at <= write_at) {\r\n            ({ next_at, size } = this.slide(1));\r\n            const do3 = subf(sub1, sub2, next_at);\r\n            last_at = do2.last_at;\r\n            next_at = do3.last_at;\r\n            now_idx++;\r\n        }\r\n        else {\r\n            const do1 = subf(sub1, sub2, last_at);\r\n            last_at = do1.last_at;\r\n            next_at = do2.last_at;\r\n        }\r\n        const zero = last_at - now_idx * size;\r\n        return new Tempo(zero, now_idx, write_at, last_at, next_at);\r\n    }\r\n    to_list(step) {\r\n        const a = step.reset(this.last_at);\r\n        const b = step.reset(this.next_at - 1);\r\n        return a.upto(b);\r\n    }\r\n    upto(limit) {\r\n        let p = this;\r\n        const ary = [];\r\n        while (p.last_at < limit.last_at) {\r\n            ary.push(p);\r\n            p = p.succ();\r\n        }\r\n        return ary;\r\n    }\r\n    slide(n) {\r\n        if (this.table) {\r\n            const now_idx = this.now_idx + n;\r\n            const idx = modulo(now_idx, this.table.length);\r\n            const new_table_idx = Math.floor(now_idx / this.table.length);\r\n            const now_table_idx = Math.floor(this.now_idx / this.table.length);\r\n            const table_idx_diff = new_table_idx - now_table_idx;\r\n            const table_diff = table_idx_diff ? this.table[this.table.length - 1] * table_idx_diff : 0;\r\n            const last_at = this.zero + table_diff + (this.table[idx - 1] || 0);\r\n            const next_at = this.zero + table_diff + this.table[idx];\r\n            const write_at = last_at + this.since;\r\n            return new Tempo(this.zero, now_idx, write_at, last_at, next_at, this.table);\r\n        }\r\n        else {\r\n            const size = n * this.size;\r\n            return to_tempo_bare(this.size, this.zero, this.write_at + size);\r\n        }\r\n    }\r\n    copy() {\r\n        return new Tempo(this.zero, this.now_idx, this.write_at, this.last_at, this.next_at, this.table);\r\n    }\r\n    reset(now = Date.now()) {\r\n        if (this.table) {\r\n            return to_tempo_by(this.table, this.zero, now);\r\n        }\r\n        else {\r\n            return to_tempo_bare(this.size, this.zero, now);\r\n        }\r\n    }\r\n    tick() {\r\n        const now = Date.now();\r\n        if (this.next_at <= now) {\r\n            return this.reset(now);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n    sleep() {\r\n        return Tempo.sleep([this]);\r\n    }\r\n    static join(a, b) {\r\n        if (a.zero != b.zero) {\r\n            throw new Error(\"can't join.\");\r\n        }\r\n        const last_at = Math.min(a.last_at, b.last_at);\r\n        const next_at = Math.max(a.next_at, b.next_at);\r\n        const write_at = (a.write_at + b.write_at) / 2;\r\n        const size = next_at - last_at;\r\n        return to_tempo_bare(size, last_at, write_at);\r\n    }\r\n    static async sleep(tempos) {\r\n        if (tempos && tempos.length) {\r\n            const o = tempos.reduce(((min, o) => min.timeout < o.timeout ? min : o), { timeout: Infinity });\r\n            if (o.timeout < Infinity) {\r\n                return new Promise((ok) => {\r\n                    setTimeout(() => {\r\n                        ok(o);\r\n                    }, o.timeout);\r\n                });\r\n            }\r\n        }\r\n        return new Promise(ok => ok(null));\r\n    }\r\n}\r\nconst modulo = (a, b) => (+a % (b = +b) + b) % b;\r\nexport function to_tempo(size_str, zero_str = \"0s\", write_at = Date.now()) {\r\n    const size = to_msec(size_str);\r\n    const zero = to_msec(zero_str) + tempo_zero;\r\n    return to_tempo_bare(size, zero, Number(write_at));\r\n}\r\nexport function to_tempo_bare(size, zero, write_at) {\r\n    const now_idx = Math.floor((write_at - zero) / size);\r\n    const last_at = (now_idx + 0) * size + zero;\r\n    const next_at = (now_idx + 1) * size + zero;\r\n    return new Tempo(zero, now_idx, write_at, last_at, next_at);\r\n}\r\n// バイナリサーチ 高速化はするが、微差なので複雑さのせいで逆に遅いかも？\r\nexport function to_tempo_by(table, zero, write_at) {\r\n    let scan_at = write_at - zero;\r\n    const table_size = table[table.length - 1];\r\n    const table_idx = Math.floor(scan_at / table_size);\r\n    if (table_idx) {\r\n        scan_at -= table_idx * table_size;\r\n    }\r\n    let now_idx = table.length;\r\n    let top_idx = 0;\r\n    let next_at = zero;\r\n    while (top_idx < now_idx) {\r\n        const mid_idx = (top_idx + now_idx) >>> 1;\r\n        next_at = table[mid_idx];\r\n        if (next_at <= scan_at) {\r\n            top_idx = mid_idx + 1;\r\n        }\r\n        else {\r\n            now_idx = mid_idx;\r\n        }\r\n    }\r\n    const last_at = zero + (table[now_idx - 1] || 0);\r\n    next_at = zero + table[now_idx];\r\n    now_idx += table_idx * table.length;\r\n    return new Tempo(zero, now_idx, write_at, last_at, next_at, table);\r\n}\r\nexport function to_msec(str) {\r\n    return 1000 * to_sec(str);\r\n}\r\nexport function to_sec(str) {\r\n    let timeout = 0;\r\n    str.replace(/(\\d+)([ヵ]?([smhdwy秒分時日週月年])[間]?(半$)?)|0/g, (_full, num_str, _fullunit, unit, appendix) => {\r\n        let num = Number(num_str);\r\n        if (!num) {\r\n            return \"\";\r\n        }\r\n        if ('半' === appendix) {\r\n            num += 0.5;\r\n        }\r\n        timeout += num * (() => {\r\n            switch (unit) {\r\n                case \"s\":\r\n                case \"秒\":\r\n                    return 1;\r\n                case \"m\":\r\n                case \"分\":\r\n                    return 60;\r\n                case \"h\":\r\n                case \"時\":\r\n                    return 3600;\r\n                case \"d\":\r\n                case \"日\":\r\n                    return 3600 * 24;\r\n                case \"w\":\r\n                case \"週\":\r\n                    return 3600 * 24 * 7;\r\n                case \"y\":\r\n                case \"年\":\r\n                    return 31556925.147;\r\n                // 2019 average.\r\n                default:\r\n                    throw new Error(`${str} at ${num}${unit}`);\r\n            }\r\n        })();\r\n        return \"\";\r\n    });\r\n    return timeout;\r\n}\r\nexport function to_timer(msec, unit_mode = 1) {\r\n    let str = \"\";\r\n    const _limit = TIMERS.length;\r\n    for (let at = 0; at < _limit; ++at) {\r\n        const unit = TIMERS[at][unit_mode];\r\n        const base = TIMERS[at][2];\r\n        const idx = Math.floor(msec / base);\r\n        if (idx) {\r\n            msec = msec % base;\r\n            str += `${idx}${unit}`;\r\n        }\r\n    }\r\n    return str;\r\n}\r\nexport function to_relative_time_distance(msec) {\r\n    if (msec < -VALID || VALID < msec || msec - 0 == NaN) {\r\n        return DISTANCE_NAN;\r\n    }\r\n    const _limit = DISTANCES.length;\r\n    for (let at = 0; at < _limit; ++at) {\r\n        const o = DISTANCES[at];\r\n        const limit = o[0];\r\n        if (msec < limit) {\r\n            return o;\r\n        }\r\n    }\r\n    return DISTANCE_LONG_AGO;\r\n}\r\n","import { useState, useEffect } from \"react\";\r\nimport { to_tempo } from './time';\r\nimport Dexie from 'dexie';\r\nconst roops = {};\r\nconst timers = {};\r\nconst is_cache = {};\r\nconst dexie = new Dexie('poll-web');\r\ndexie.version(1).stores({\r\n    meta: '&idx',\r\n    data: '&idx',\r\n});\r\nif (typeof window !== 'undefined') {\r\n    window.addEventListener('offline', network_state);\r\n    window.addEventListener('online', network_state);\r\n    document.addEventListener('visibilitychange', network_state);\r\n}\r\nfunction network_state() {\r\n    const is_online = window.navigator.onLine;\r\n    const is_visible = 'hidden' != document.visibilityState;\r\n    const is_active = is_online && is_visible;\r\n    if (is_active) {\r\n        Object.values(roops).forEach((roop) => roop());\r\n    }\r\n    else {\r\n        Object.values(timers).forEach(clearTimeout);\r\n    }\r\n}\r\nexport function usePoll(api, initState, timestr, version, args = []) {\r\n    const idx = [api.name, ...args].join('&');\r\n    let tempo = to_tempo(timestr);\r\n    const [list, setList] = useState(initState);\r\n    useEffect(() => {\r\n        roops[idx] = roop;\r\n        const p = roop();\r\n        return () => {\r\n            clearTimeout(timers[idx]);\r\n            delete roops[idx];\r\n            delete timers[idx];\r\n        };\r\n    }, []);\r\n    return [list, setList];\r\n    async function roop() {\r\n        var _a, _b, _c;\r\n        let meta = null;\r\n        let data = null;\r\n        tempo = tempo.reset();\r\n        const { timeout, write_at, next_at } = tempo;\r\n        try {\r\n            if (write_at < is_cache[idx]) {\r\n                get_pass();\r\n            }\r\n            else {\r\n                // IndexedDB metadata not use if memory has past data, \r\n                if (!(0 < is_cache[idx])) {\r\n                    meta = await dexie.table('meta').get(idx);\r\n                    if (((_a = meta) === null || _a === void 0 ? void 0 : _a.version) !== version) {\r\n                        meta = null;\r\n                    }\r\n                }\r\n                if (write_at < ((_b = meta) === null || _b === void 0 ? void 0 : _b.next_at)) {\r\n                    await get_by_lf();\r\n                }\r\n                else if (0 < ((_c = meta) === null || _c === void 0 ? void 0 : _c.next_at)) {\r\n                    await get_by_lf();\r\n                    await get_by_api();\r\n                }\r\n                else {\r\n                    await get_by_api();\r\n                    dexie.table('meta').put({ idx, version, next_at });\r\n                }\r\n            }\r\n            is_cache[idx] = next_at;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n        if (timeout < 0x7fffffff) { // 25days\r\n            timers[idx] = setTimeout(roop, timeout);\r\n        }\r\n        async function get_pass() {\r\n            console.log({ wait: new Date().getTime() - write_at, idx, mode: null });\r\n        }\r\n        async function get_by_lf() {\r\n            var _a;\r\n            data = await dexie.table('data').get(idx);\r\n            // Mem.State.store(meta)\r\n            setList((_a = data) === null || _a === void 0 ? void 0 : _a.pack);\r\n            console.log({ wait: new Date().getTime() - write_at, idx, mode: '(lf)' });\r\n        }\r\n        async function get_by_api() {\r\n            const pack = await api(...args);\r\n            // TODO: data to meta api.\r\n            // meta = Mem.State.transaction(()=> cb(data),{})\r\n            data = { idx, pack };\r\n            await dexie.table('data').put(data);\r\n            setList(pack);\r\n            console.log({ wait: new Date().getTime() - write_at, idx, mode: '(api)' });\r\n        }\r\n    }\r\n}\r\n","import { useState, useEffect } from \"react\";\r\nimport * as _ from \"lodash\";\r\nconst BITLIMIT = 31;\r\nconst BITMASK = 2 ** 31 - 1;\r\nexport class Bits {\r\n    static by_str(o, base) {\r\n        const bits = [null, undefined, \"undefined\"].includes(o) ? 0 : Number.parseInt(o, 36);\r\n        return base._.copy(bits);\r\n    }\r\n    static to_str(o) {\r\n        return o.bits.toString(36);\r\n    }\r\n    static min(x) { return x & (-x); }\r\n    static assign(labels) {\r\n        if (BITLIMIT < labels.length) {\r\n            throw new Error(\"too much bits.\");\r\n        }\r\n        class BitsProcess {\r\n            constructor(target) {\r\n                this.target = target;\r\n                this.labels = labels;\r\n            }\r\n            copy(x = this.target.bits) {\r\n                return new BitsBox(x);\r\n            }\r\n            calc(cb) {\r\n                const x = this.target.bits;\r\n                return this.copy(cb(x));\r\n            }\r\n            get labels_off() { return BitsProcess.get_labels(BITMASK - this.target.bits); }\r\n            get labels_on() { return BitsProcess.get_labels(this.target.bits); }\r\n            static get_labels(x) {\r\n                let count = labels.length;\r\n                let idx = 0;\r\n                const res = [];\r\n                do {\r\n                    if (x & 1 && labels[idx]) {\r\n                        res.push(labels[idx]);\r\n                    }\r\n                    x >>>= 1;\r\n                    ++idx;\r\n                } while (--count);\r\n                return res.reverse();\r\n            }\r\n        }\r\n        class BitsBox extends Bits {\r\n            constructor(bits) {\r\n                super();\r\n                this.bits = bits;\r\n                this._ = new BitsProcess(this);\r\n            }\r\n            static by(labels) {\r\n                const o = new BitsBox(0);\r\n                labels.forEach((label) => {\r\n                    o[label] = true;\r\n                });\r\n                return o;\r\n            }\r\n        }\r\n        BitsBox.all = new BitsBox(BITMASK);\r\n        BitsBox.zero = new BitsBox(0);\r\n        labels.forEach((label, idx) => {\r\n            const bit = 2 ** idx;\r\n            const mask = BITMASK - bit;\r\n            Object.defineProperty(BitsBox.prototype, label, {\r\n                enumerable: true,\r\n                get: function () { return Boolean(this.bits & bit); },\r\n                set: function (b) {\r\n                    this.bits = this.bits & mask | (bit * Number(to_Boolean(b)));\r\n                }\r\n            });\r\n        });\r\n        return BitsBox;\r\n    }\r\n}\r\nfunction to_String(u, nil) { return u ? String(u) : nil; }\r\nfunction to_Number(u) { return u ? Number(u) : NaN; }\r\nfunction to_Array(u) { return u instanceof Array ? u : u ? Array(u) : []; }\r\nfunction to_Object(u) { return u instanceof Object ? u : {}; }\r\nfunction to_Boolean(u) { return !!u && !['0', 'false'].includes(u); }\r\nfunction to_str(o, base) {\r\n    switch (base.constructor) {\r\n        case String: return to_String(o, '');\r\n        case Number: return to_String(o, '');\r\n        case Boolean: return to_String(to_Boolean(o), '');\r\n    }\r\n    if (base instanceof Bits) {\r\n        return Bits.to_str(o);\r\n    }\r\n    if (base instanceof Array) {\r\n        return JSON.stringify(to_Array(o));\r\n    }\r\n    return JSON.stringify(to_Object(o));\r\n}\r\nfunction by_str(o, base) {\r\n    switch (base.constructor) {\r\n        case String: return to_String(o, undefined);\r\n        case Number: return to_Number(o);\r\n        case Boolean: return to_Boolean(o);\r\n    }\r\n    if (base instanceof Bits) {\r\n        return Bits.by_str(o, base);\r\n    }\r\n    if (base instanceof Array) {\r\n        return JSON.parse(o) || [];\r\n    }\r\n    return JSON.parse(o) || {};\r\n}\r\nfunction to_url(o, base) {\r\n    switch (base.constructor) {\r\n        case String: return [encodeURIComponent(to_String(o, ''))];\r\n        case Number: return [to_String(to_Number(o), '')];\r\n        case Boolean: return [to_String(to_Boolean(o), '')];\r\n    }\r\n    if (base instanceof Bits) {\r\n        return [Bits.to_str(o)];\r\n    }\r\n    if (base instanceof Array) {\r\n        return to_Array(o).map(encodeURIComponent);\r\n    }\r\n}\r\nfunction by_url(o, base) {\r\n    switch (base.constructor) {\r\n        case String: return to_String(decodeURIComponent(o[0]), '');\r\n        case Number: return to_Number(decodeURIComponent(o[0]));\r\n        case Boolean: return to_Boolean(o[0]);\r\n    }\r\n    if (base instanceof Bits) {\r\n        return Bits.by_str(o[0], base);\r\n    }\r\n    if (base instanceof Array) {\r\n        return to_Array(o).map(decodeURIComponent);\r\n    }\r\n}\r\n//\r\n// data store.\r\n//\r\nconst defaults = {};\r\nconst dataStore = {};\r\nconst share = {};\r\nexport const debug = { share, dataStore, defaults };\r\nfunction doShare(path, tail, val, base) {\r\n    const key = path.join('.');\r\n    if (!share[key]) {\r\n        return;\r\n    }\r\n    share[key].forEach((cb) => {\r\n        cb(val, base);\r\n    });\r\n    // console.warn( path, tail, share[key].length )\r\n}\r\nfunction doSharesDown(path, tail, val, base) {\r\n    if (base instanceof Object) {\r\n        Object.keys(val).forEach((key) => {\r\n            if (tail === key) {\r\n                return;\r\n            }\r\n            if ('_' === key[0]) {\r\n                return;\r\n            }\r\n            const extPath = [...path, key];\r\n            const base = _.get(defaults, extPath);\r\n            const val = _.get(dataStore, extPath);\r\n            doSharesDown(extPath, undefined, val, base);\r\n        });\r\n    }\r\n    doShare(path, tail, val, base);\r\n}\r\nfunction doSharesUp(path) {\r\n    let idx = path.length;\r\n    do {\r\n        const tail = path[idx];\r\n        const subPath = path.slice(0, idx);\r\n        const base = _.get(defaults, subPath);\r\n        const val = _.get(dataStore, subPath);\r\n        doSharesDown(subPath, tail, val, base);\r\n    } while (--idx);\r\n}\r\nexport function pushState(o) { defineUrlStore(pushStateStorage, o); }\r\nexport function replaceState(o) { defineUrlStore(replaceStateStorage, o); }\r\nfunction defineUrlStore(store, o) {\r\n    defineStore(store, o, to_url, by_url);\r\n    store.reset(o);\r\n}\r\nexport function localStore(o) { defineStore(LocalStorage, o, to_str, by_str); }\r\nexport function sessionStore(o) { defineStore(SessionStorage, o, to_str, by_str); }\r\nfunction defineStore(storage, o, to, by) {\r\n    Object.keys(o).forEach((rootPath) => {\r\n        const val = o[rootPath];\r\n        const item = storage.getItem(rootPath);\r\n        const rootCb = _.debounce((val) => {\r\n            if (val) {\r\n                storage.setItem(rootPath, to(val, defaults[rootPath]));\r\n            }\r\n            else {\r\n                storage.removeItem(rootPath);\r\n            }\r\n        }, 100);\r\n        defaults[rootPath] = val;\r\n        if (!share[rootPath]) {\r\n            share[rootPath] = new Set();\r\n        }\r\n        share[rootPath].add(rootCb);\r\n        if (item) {\r\n            dataStore[rootPath] = by(item, val);\r\n        }\r\n        else {\r\n            dataStore[rootPath] = val;\r\n            rootCb(val);\r\n        }\r\n    });\r\n}\r\nclass UrlStorage {\r\n    constructor(mode) {\r\n        this.mode = mode;\r\n        this.rootPaths = [];\r\n        this.data = { PATH: [\"\"], HASH: [\"\"], BASIC_AUTH: [\"\", \"\"] };\r\n    }\r\n    getItem(key) {\r\n        return this.data[key];\r\n    }\r\n    setItem(key, val) {\r\n        if (val !== this.data[key]) {\r\n            this.data[key] = val;\r\n            this.store();\r\n        }\r\n        else {\r\n            this.data[key] = val;\r\n        }\r\n    }\r\n    removeItem(key) {\r\n        if (this.data[key]) {\r\n            delete this.data[key];\r\n            this.store();\r\n        }\r\n        else {\r\n            delete this.data[key];\r\n        }\r\n    }\r\n    reset(defs) {\r\n        this.rootPaths.forEach((rootPath) => {\r\n            rootPath;\r\n        });\r\n        this.rootPaths = Object.keys(defs);\r\n        this.data = UrlStorage.parse();\r\n        this.store('replaceState');\r\n    }\r\n    store(mode = this.mode) {\r\n        const href = UrlStorage.stringify(this.data);\r\n        if (typeof window !== 'undefined') {\r\n            history[mode](this.data, '', href);\r\n        }\r\n    }\r\n    static parse(href = BaseUrl(), base = BaseUrl()) {\r\n        const { hash, search, pathname, username, password, protocol, host, hostname } = new URL(href, base);\r\n        const data = {\r\n            PATH: pathname.split(/\\/+/).slice(1),\r\n            HASH: [hash.slice(1)],\r\n            BASIC_AUTH: [username, password],\r\n        };\r\n        search.slice(1).split('&').forEach((query) => {\r\n            const [key, ...vals] = query.split(\"=\");\r\n            if (!key) {\r\n                return;\r\n            }\r\n            data[key] = vals;\r\n        });\r\n        return data;\r\n    }\r\n    static stringify(data, base = BaseUrl()) {\r\n        const hash = data.HASH[0] ? `#${data.HASH[0]}` : '';\r\n        let search = \"\";\r\n        for (const key in data) {\r\n            switch (key) {\r\n                case 'PATH':\r\n                case 'HASH':\r\n                case 'BASIC_AUTH':\r\n                    break;\r\n                default:\r\n                    if (data[key].length) {\r\n                        search += `&${key}=${data[key].join(\"=\")}`;\r\n                    }\r\n                    else {\r\n                        search += `&${key}`;\r\n                    }\r\n            }\r\n        }\r\n        if (search) {\r\n            search = `?${search.slice(1)}`;\r\n        }\r\n        return new URL(`${search}${hash}`, base).href;\r\n    }\r\n}\r\nexport const pushStateStorage = new UrlStorage('pushState');\r\nexport const replaceStateStorage = new UrlStorage('replaceState');\r\nexport function useStore(path_obj) {\r\n    const path = _.toPath(path_obj);\r\n    const key = path.join('.');\r\n    const setter = (val) => {\r\n        _.set(dataStore, path, val);\r\n        doSharesUp(path);\r\n    };\r\n    if (!share[key]) {\r\n        share[key] = new Set();\r\n    }\r\n    const [item, setItem] = useState(_.get(dataStore, path));\r\n    useEffect(() => {\r\n        share[key].add(setItem);\r\n        return () => {\r\n            share[key].delete(setItem);\r\n        };\r\n    }, [key]);\r\n    return [item, setter];\r\n}\r\nlet BaseUrl;\r\nlet LocalStorage;\r\nlet SessionStorage;\r\nif (typeof window !== \"undefined\") {\r\n    BaseUrl = () => window.location.href;\r\n    LocalStorage = window.localStorage;\r\n    SessionStorage = window.sessionStorage;\r\n    window.addEventListener('popstate', (e) => {\r\n        const data = UrlStorage.parse();\r\n        console.warn(e);\r\n    });\r\n    window.addEventListener(\"storage\", ({ key, newValue }) => {\r\n        if (!key || !newValue) {\r\n            return;\r\n        }\r\n        const base = defaults[key];\r\n        if (!base) {\r\n            return;\r\n        }\r\n        const val = by_str(newValue, base);\r\n        dataStore[key] = val;\r\n        doSharesUp([key]);\r\n    });\r\n}\r\nelse {\r\n    BaseUrl = () => \"https://localhost/\";\r\n    const dummyStorage = {\r\n        getItem(label) { return ''; },\r\n        setItem(label) { },\r\n        removeItem(label) { }\r\n    };\r\n    LocalStorage = SessionStorage = dummyStorage;\r\n}\r\n"],"sourceRoot":""}